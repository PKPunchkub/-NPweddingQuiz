<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Namkhing & Punch Wedding Games - ‡πÄ‡∏Å‡∏°‡∏ó‡∏≤‡∏¢‡πÉ‡∏à‡∏Ñ‡∏π‡πà‡∏ö‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏ß</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;700&display=swap');
        body { font-family: 'Kanit', sans-serif; }
        
        .answer-btn {
            transition: all 0.3s ease;
            transform: scale(1);
        }
        
        .answer-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        
        .correct-answer {
            animation: correctPulse 0.6s ease-in-out;
        }
        
        .wrong-answer {
            animation: wrongShake 0.6s ease-in-out;
        }
        
        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); background-color: #10b981; }
            100% { transform: scale(1); }
        }
        
        @keyframes wrongShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        .progress-bar {
            transition: width 1s linear;
        }
        
        .player-card {
            transition: all 0.3s ease;
        }
        
        .player-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .floating-hearts {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
        }
        
        .heart {
            position: absolute;
            color: #ff69b4;
            font-size: 20px;
            animation: float 6s infinite linear;
        }
        
        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-pink-400 via-purple-500 to-indigo-600 min-h-screen relative">
    <!-- Floating Hearts Background -->
    <div class="floating-hearts" id="heartsContainer"></div>

    <!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏´‡∏•‡∏±‡∏Å (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î) -->
    <div id="homeScreen" class="flex items-center justify-center min-h-screen p-4">
        <div class="text-center bg-white rounded-3xl p-8 shadow-2xl max-w-md mx-4">
            <div class="text-6xl mb-4">üíï</div>
            <h1 class="text-3xl font-bold text-gray-800 mb-2">Namkhing & Punch Wedding Games</h1>
            <p class="text-lg text-pink-600 font-semibold mb-6">‡πÄ‡∏Å‡∏°‡∏ó‡∏≤‡∏¢‡πÉ‡∏à‡∏Ñ‡∏π‡πà‡∏ö‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏ß (Guess the Couple's Mind Game)</p>
            
            <!-- ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô -->
            <div class="bg-blue-50 p-4 rounded-xl mb-6 border-2 border-blue-200">
                <h3 class="text-sm font-bold text-blue-800 mb-2">üìã ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (How to Use)</h3>
                <div class="text-xs text-blue-700 space-y-1">
                    <p>üíª <strong>Host:</strong> ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÄ‡∏Å‡∏°</p>
                    <p>üì± <strong>‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô:</strong> ‡πÉ‡∏ä‡πâ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡∏™‡πÅ‡∏Å‡∏ô QR Code</p>
                    <p>üéÆ ‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 250 ‡∏Ñ‡∏ô</p>
                </div>
            </div>
            
            <div class="space-y-4">
                <button onclick="showHostScreen()" class="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-8 py-4 rounded-full text-xl font-semibold hover:from-purple-600 hover:to-pink-600 transform hover:scale-105 transition-all duration-300 shadow-lg w-full">
                    üéØ ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏†‡∏≤‡∏û (Host - Create QR Code)
                </button>
                
                <button onclick="showRegisterScreen()" class="bg-gradient-to-r from-pink-500 to-purple-500 text-white px-8 py-4 rounded-full text-xl font-semibold hover:from-pink-600 hover:to-purple-600 transform hover:scale-105 transition-all duration-300 shadow-lg w-full">
                    üë• ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏Å‡∏° (Join Game)
                </button>
            </div>
            
            <div class="mt-6 text-sm text-gray-600">
                <p>‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå (Online Players): <span id="onlineCount" class="font-bold text-pink-600">0</span> ‡∏Ñ‡∏ô</p>
            </div>
        </div>
    </div>

    <!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô Admin -->
    <div id="passwordScreen" class="hidden flex items-center justify-center min-h-screen p-4">
        <div class="text-center bg-white rounded-3xl p-8 shadow-2xl max-w-md mx-4">
            <div class="text-6xl mb-4">üîê</div>
            <h1 class="text-3xl font-bold text-gray-800 mb-2">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô Admin (Admin Verification)</h1>
            <p class="text-lg text-purple-600 font-semibold mb-8">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏à‡πâ‡∏≤‡∏†‡∏≤‡∏û (Please enter password to access host mode)</p>
            
            <div class="mb-6">
                <input type="password" id="adminPassword" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô Admin (Admin Password)" 
                       class="w-full px-4 py-3 border-2 border-purple-300 rounded-xl text-lg focus:border-purple-500 focus:outline-none text-center"
                       onkeypress="if(event.key==='Enter') verifyPassword()">
            </div>
            
            <div class="space-y-4">
                <button onclick="verifyPassword()" class="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-8 py-4 rounded-full text-xl font-semibold hover:from-purple-600 hover:to-pink-600 transform hover:scale-105 transition-all duration-300 shadow-lg w-full">
                    üîì ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (Verify Password)
                </button>
                
                <button onclick="showHomeScreen()" class="bg-gray-500 text-white px-6 py-3 rounded-full text-lg font-semibold hover:bg-gray-600 transform hover:scale-105 transition-all duration-300 shadow-lg w-full">
                    ‚Üê ‡∏Å‡∏•‡∏±‡∏ö (Back)
                </button>
            </div>
        </div>
    </div>

    <!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏†‡∏≤‡∏û (‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code) -->
    <div id="hostScreen" class="hidden flex items-center justify-center min-h-screen p-4">
        <div class="text-center bg-white rounded-3xl p-8 shadow-2xl max-w-lg mx-4">
            <div class="text-4xl mb-4">üéØ</div>
            <h2 class="text-2xl font-bold text-gray-800 mb-2">Host Control Panel</h2>
            <p class="text-lg text-purple-600 font-semibold mb-6">‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÄ‡∏Å‡∏°‡∏à‡∏≤‡∏Å‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå (Control game from computer)</p>
            
            <!-- ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏´‡πâ‡∏≠‡∏á -->
            <div class="bg-purple-100 p-4 rounded-xl mb-6 border-2 border-purple-300">
                <h3 class="text-lg font-bold text-purple-800 mb-2">üè† ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô (Room Status)</h3>
                <div class="grid grid-cols-2 gap-4 text-sm">
                    <div class="bg-white p-3 rounded-lg">
                        <p class="text-gray-600">Room ID</p>
                        <p id="hostRoomDisplay" class="font-bold text-purple-600">-</p>
                    </div>
                    <div class="bg-white p-3 rounded-lg">
                        <p class="text-gray-600">‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</p>
                        <p class="font-bold text-green-600"><span id="hostOnlineCount">0</span> ‡∏Ñ‡∏ô</p>
                    </div>
                </div>
                <div class="mt-3 text-xs text-purple-600">
                    <p>‚úÖ ‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô - ‡πÉ‡∏´‡πâ‡πÅ‡∏Ç‡∏Å‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á</p>
                    <p>üì± ‡πÅ‡∏Ç‡∏Å‡πÉ‡∏ä‡πâ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô | üíª Host ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</p>
                </div>
            </div>
            
            <!-- QR Code -->
            <div class="bg-gray-50 p-6 rounded-2xl mb-6">
                <div id="qrcode" class="flex justify-center mb-4"></div>
                <p class="text-sm text-gray-600 mb-4">üì± ‡πÉ‡∏´‡πâ‡πÅ‡∏Ç‡∏Å‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏Å‡∏°<br>(Let guests scan this QR Code with mobile phone to join)</p>
                
                <!-- ‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏ä‡∏£‡πå -->
                <div class="bg-white p-4 rounded-xl border-2 border-dashed border-gray-300">
                    <p class="text-xs text-gray-500 mb-2">‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏ä‡∏£‡πå‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ô‡∏µ‡πâ (Or share this link):</p>
                    <div class="flex items-center gap-2">
                        <input type="text" id="shareLink" readonly 
                               class="flex-1 px-3 py-2 text-sm border border-gray-300 rounded-lg bg-gray-50">
                        <button onclick="copyLink()" class="bg-blue-500 text-white px-4 py-2 rounded-lg text-sm hover:bg-blue-600 transition-colors">
                            üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å (Copy)
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="space-y-4">
                <button onclick="showWaitingScreenAsHost()" class="bg-gradient-to-r from-green-500 to-blue-500 text-white px-8 py-4 rounded-full text-xl font-semibold hover:from-green-600 hover:to-blue-600 transform hover:scale-105 transition-all duration-300 shadow-lg w-full">
                    üìä ‡∏î‡∏π‡∏´‡πâ‡∏≠‡∏á‡∏£‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô (View Waiting Room)
                </button>
                
                <button onclick="debugGameState()" class="bg-red-500 text-white px-6 py-3 rounded-full text-lg font-semibold hover:bg-red-600 transform hover:scale-105 transition-all duration-300 shadow-lg w-full">
                    üîç Debug Info
                </button>
                
                <button onclick="showHomeScreen()" class="bg-gray-500 text-white px-6 py-3 rounded-full text-lg font-semibold hover:bg-gray-600 transform hover:scale-105 transition-all duration-300 shadow-lg w-full">
                    ‚Üê ‡∏Å‡∏•‡∏±‡∏ö (Back)
                </button>
            </div>
        </div>
    </div>

    <!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô -->
    <div id="registerScreen" class="hidden flex items-center justify-center min-h-screen p-4">
        <div class="text-center bg-white rounded-3xl p-8 shadow-2xl max-w-md mx-4">
            <div class="text-6xl mb-4">üíï</div>
            <h1 class="text-3xl font-bold text-gray-800 mb-2">‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏Å‡∏° (Join Game)</h1>
            <p class="text-lg text-pink-600 font-semibold mb-6">‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (Fill in your information)</p>
            
            <div class="mb-6">
                <input type="text" id="playerName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (Your Name)" 
                       class="w-full px-4 py-3 border-2 border-pink-300 rounded-xl text-lg focus:border-pink-500 focus:outline-none mb-4">
                <input type="text" id="playerTable" placeholder="‡πÇ‡∏ï‡πä‡∏∞‡∏ó‡∏µ‡πà (Table Number - Optional)" 
                       class="w-full px-4 py-3 border-2 border-pink-300 rounded-xl text-lg focus:border-pink-500 focus:outline-none">
            </div>
            
            <div class="space-y-4">
                <button onclick="registerPlayer()" class="bg-gradient-to-r from-pink-500 to-purple-500 text-white px-8 py-4 rounded-full text-xl font-semibold hover:from-pink-600 hover:to-purple-600 transform hover:scale-105 transition-all duration-300 shadow-lg w-full">
                    ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏Å‡∏° (Join Game) üíñ
                </button>
                
                <button onclick="showHomeScreen()" class="bg-gray-500 text-white px-6 py-3 rounded-full text-lg font-semibold hover:bg-gray-600 transform hover:scale-105 transition-all duration-300 shadow-lg w-full">
                    ‚Üê ‡∏Å‡∏•‡∏±‡∏ö (Back)
                </button>
            </div>
            
            <div class="mt-6 text-sm text-gray-600">
                <p>‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå: <span id="onlineCountRegister" class="font-bold text-pink-600">0</span> ‡∏Ñ‡∏ô</p>
            </div>
        </div>
    </div>

    <!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏£‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏° -->
    <div id="waitingScreen" class="hidden min-h-screen p-4">
        <div class="max-w-6xl mx-auto">
            <!-- Header -->
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold text-white mb-4">üéâ ‡∏´‡πâ‡∏≠‡∏á‡∏£‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏° (Waiting Room) üéâ</h1>
                <div class="bg-white rounded-full px-6 py-3 inline-block shadow-lg mb-4">
                    <span class="text-xl font-semibold">‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (Total Players): <span id="totalPlayers" class="text-pink-600">0</span> ‡∏Ñ‡∏ô</span>
                </div>
                <div id="roomInfoWaiting" class="bg-white bg-opacity-20 rounded-full px-4 py-2 inline-block">
                    <span class="text-white text-sm">üè† ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô: <span id="waitingRoomId">-</span></span>
                </div>
            </div>

            <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô -->
            <div class="bg-white rounded-3xl p-6 mb-8 shadow-2xl">
                <h3 class="text-2xl font-bold text-center mb-4">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (Your Information)</h3>
                <div class="text-center">
                    <div id="playerCharacter" class="text-6xl mb-4"></div>
                    <p class="text-xl">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ (Hello) <span id="welcomeName" class="font-bold text-pink-600"></span>!</p>
                    <p id="welcomeTable" class="text-gray-600"></p>
                    <p class="text-sm text-gray-500 mt-2">‡∏£‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏ö‡πà‡∏≤‡∏ß‡πÄ‡∏à‡πâ‡∏≤‡∏™‡∏≤‡∏ß‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡∏ô‡∏∞‡∏Ñ‡∏∞... (Waiting for the bride and groom to start the game...)</p>
                </div>
            </div>

            <!-- ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô -->
            <div class="bg-white rounded-3xl p-6 shadow-2xl">
                <h3 class="text-xl font-bold text-center mb-4">‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏° (Joined Players)</h3>
                <div id="playersList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 max-h-96 overflow-y-auto">
                    <!-- ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
                </div>
            </div>

            <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏° (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Admin ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô) -->
            <div class="text-center mt-8 space-y-4">
                <div class="flex justify-center">
                    <button id="startGameBtn" onclick="startGame()" class="bg-gradient-to-r from-green-500 to-blue-500 text-white px-12 py-4 rounded-full text-xl font-semibold hover:from-green-600 hover:to-blue-600 transform hover:scale-105 transition-all duration-300 shadow-lg" style="display: none;">
                        üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏° (Start Game)
                    </button>
                </div>
                
                <div id="waitingMessage" class="bg-white rounded-full px-8 py-4 inline-block shadow-lg">
                    <p class="text-lg text-gray-700">‚è≥ ‡∏£‡∏≠ Admin ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°... (Waiting for Admin to start the game...)</p>
                </div>
                
                <button onclick="goBackFromWaiting()" class="bg-gray-500 text-white px-8 py-3 rounded-full text-lg font-semibold hover:bg-gray-600 transform hover:scale-105 transition-all duration-300 shadow-lg">
                    ‚Üê ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö (Back)
                </button>
            </div>
        </div>
    </div>

    <!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏Å‡∏° -->
    <div id="gameScreen" class="hidden min-h-screen p-4">
        <!-- Header -->
        <div class="flex justify-between items-center mb-6 flex-wrap gap-4">
            <div class="bg-white rounded-full px-6 py-3 shadow-lg">
                <span class="text-lg font-semibold">‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà (Question) <span id="questionNumber">1</span>/5</span>
            </div>
            <div class="bg-white rounded-full px-6 py-3 shadow-lg flex items-center">
                <span id="gamePlayerCharacter" class="text-2xl mr-2">üê∂</span>
                <span class="text-lg font-semibold">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (Score): <span id="score">0</span></span>
            </div>
            <div class="bg-white rounded-full px-6 py-3 shadow-lg">
                <span class="text-lg font-semibold">‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô (Players): <span id="gamePlayerCount">0</span> ‡∏Ñ‡∏ô</span>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="bg-white rounded-full h-3 mb-8 shadow-inner">
            <div id="progressBar" class="progress-bar bg-gradient-to-r from-pink-400 to-purple-500 h-full rounded-full" style="width: 0%"></div>
        </div>

        <!-- Timer -->
        <div class="text-center mb-6">
            <div id="timer" class="text-6xl font-bold text-white drop-shadow-lg">10</div>
            <p class="text-white text-xl">‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (seconds)</p>
        </div>

        <!-- ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° -->
        <div class="bg-white rounded-3xl p-8 mb-8 shadow-2xl text-center">
            <h2 id="questionText" class="text-2xl md:text-3xl font-bold text-gray-800 mb-4"></h2>
        </div>

        <!-- ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 max-w-4xl mx-auto">
            <button id="answer0" class="answer-btn bg-red-500 hover:bg-red-600 text-white p-6 rounded-2xl text-xl font-semibold shadow-lg" onclick="selectAnswer(0)">
                <div class="flex items-center justify-center">
                    <span class="mr-3">üî∫</span>
                    <span id="answerText0"></span>
                </div>
            </button>
            <button id="answer1" class="answer-btn bg-blue-500 hover:bg-blue-600 text-white p-6 rounded-2xl text-xl font-semibold shadow-lg" onclick="selectAnswer(1)">
                <div class="flex items-center justify-center">
                    <span class="mr-3">üíé</span>
                    <span id="answerText1"></span>
                </div>
            </button>
            <button id="answer2" class="answer-btn bg-yellow-500 hover:bg-yellow-600 text-white p-6 rounded-2xl text-xl font-semibold shadow-lg" onclick="selectAnswer(2)">
                <div class="flex items-center justify-center">
                    <span class="mr-3">‚≠ï</span>
                    <span id="answerText2"></span>
                </div>
            </button>
            <button id="answer3" class="answer-btn bg-green-500 hover:bg-green-600 text-white p-6 rounded-2xl text-xl font-semibold shadow-lg" onclick="selectAnswer(3)">
                <div class="flex items-center justify-center">
                    <span class="mr-3">‚¨ú</span>
                    <span id="answerText3"></span>
                </div>
            </button>
        </div>
    </div>

    <!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ Host Dashboard -->
    <div id="hostDashboard" class="hidden min-h-screen p-4">
        <div class="max-w-6xl mx-auto">
            <!-- Header -->
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold text-white mb-4">üéØ Host Dashboard - ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÄ‡∏Å‡∏°</h1>
                <div class="bg-white rounded-full px-6 py-3 inline-block shadow-lg mb-4">
                    <span class="text-xl font-semibold">‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà (Question): <span id="hostQuestionNumber">1</span>/5</span>
                </div>
                <div class="bg-white bg-opacity-20 rounded-full px-4 py-2 inline-block">
                    <span class="text-white text-sm">üè† ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô: <span id="hostRoomId">-</span> | ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô: <span id="hostPlayerCount">0</span> ‡∏Ñ‡∏ô</span>
                </div>
            </div>

            <!-- ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô -->
            <div class="bg-white rounded-3xl p-8 mb-8 shadow-2xl">
                <h3 class="text-2xl font-bold text-center mb-4">‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (Current Question)</h3>
                <div class="text-center mb-6">
                    <div id="hostTimer" class="text-6xl font-bold text-purple-600 mb-2">10</div>
                    <p class="text-gray-600 text-xl">‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (Seconds remaining)</p>
                </div>
                <div class="bg-gray-50 p-6 rounded-2xl mb-6">
                    <h4 id="hostQuestionText" class="text-xl font-semibold text-gray-800 mb-4"></h4>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-red-100 p-4 rounded-xl">
                            <span class="text-red-600 font-semibold">üî∫ A:</span>
                            <span id="hostAnswer0" class="ml-2"></span>
                        </div>
                        <div class="bg-blue-100 p-4 rounded-xl">
                            <span class="text-blue-600 font-semibold">üíé B:</span>
                            <span id="hostAnswer1" class="ml-2"></span>
                        </div>
                        <div class="bg-yellow-100 p-4 rounded-xl">
                            <span class="text-yellow-600 font-semibold">‚≠ï C:</span>
                            <span id="hostAnswer2" class="ml-2"></span>
                        </div>
                        <div class="bg-green-100 p-4 rounded-xl" id="hostCorrectAnswer">
                            <span class="text-green-600 font-semibold">‚¨ú D:</span>
                            <span id="hostAnswer3" class="ml-2"></span>
                        </div>
                    </div>
                    <div class="mt-4 text-center">
                        <p class="text-sm text-gray-600">‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: <span id="hostCorrectText" class="font-bold text-green-600"></span></p>
                    </div>
                </div>
            </div>

            <!-- ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö Real-time -->
            <div class="bg-white rounded-3xl p-8 mb-8 shadow-2xl">
                <h3 class="text-2xl font-bold text-center mb-6">üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö Real-time</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-red-100 p-4 rounded-xl text-center">
                        <div class="text-2xl font-bold text-red-600" id="answerStatsA">0</div>
                        <div class="text-sm text-red-600">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å A</div>
                    </div>
                    <div class="bg-blue-100 p-4 rounded-xl text-center">
                        <div class="text-2xl font-bold text-blue-600" id="answerStatsB">0</div>
                        <div class="text-sm text-blue-600">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å B</div>
                    </div>
                    <div class="bg-yellow-100 p-4 rounded-xl text-center">
                        <div class="text-2xl font-bold text-yellow-600" id="answerStatsC">0</div>
                        <div class="text-sm text-yellow-600">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å C</div>
                    </div>
                    <div class="bg-green-100 p-4 rounded-xl text-center">
                        <div class="text-2xl font-bold text-green-600" id="answerStatsD">0</div>
                        <div class="text-sm text-green-600">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å D</div>
                    </div>
                </div>
                <div class="text-center">
                    <p class="text-lg">‡∏ï‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß: <span id="answeredCount" class="font-bold text-purple-600">0</span> / <span id="totalPlayersCount">0</span> ‡∏Ñ‡∏ô</p>
                </div>
            </div>

            <!-- Scoreboard -->
            <div class="bg-white rounded-3xl p-8 shadow-2xl">
                <h3 class="text-2xl font-bold text-center mb-6">üèÜ Scoreboard ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</h3>
                <div id="hostLeaderboard" class="space-y-3 max-h-96 overflow-y-auto">
                    <!-- Scoreboard ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
                </div>
            </div>

            <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° -->
            <div class="text-center mt-8 space-y-4">
                <button onclick="hostEndGame()" class="bg-gradient-to-r from-red-500 to-pink-500 text-white px-8 py-4 rounded-full text-xl font-semibold hover:from-red-600 hover:to-pink-600 transform hover:scale-105 transition-all duration-300 shadow-lg">
                    üèÅ ‡∏à‡∏ö‡πÄ‡∏Å‡∏° (End Game)
                </button>
                
                <button onclick="showHostScreen()" class="bg-gray-500 text-white px-8 py-3 rounded-full text-lg font-semibold hover:bg-gray-600 transform hover:scale-105 transition-all duration-300 shadow-lg">
                    ‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏à‡πâ‡∏≤‡∏†‡∏≤‡∏û (Back to Host)
                </button>
            </div>
        </div>
    </div>

    <!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå -->
    <div id="resultScreen" class="hidden min-h-screen p-4">
        <div class="max-w-4xl mx-auto">
            <div class="text-center mb-8">
                <div id="resultEmoji" class="text-8xl mb-6">üèÜ</div>
                <h2 class="text-4xl font-bold text-white mb-4">üéâ ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô (Results) üéâ</h2>
            </div>

            <!-- ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô) -->
            <div id="playerScoreSection" class="bg-white rounded-3xl p-8 mb-8 shadow-2xl text-center">
                <h3 class="text-2xl font-bold mb-4">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (Your Score)</h3>
                <p class="text-5xl font-bold text-pink-600 mb-2"><span id="finalScore">0</span>/5</p>
                <p id="playerRank" class="text-xl text-gray-600"></p>
            </div>

            <!-- ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô -->
            <div class="bg-white rounded-3xl p-8 shadow-2xl">
                <h3 class="text-2xl font-bold text-center mb-6">üèÜ ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô Top 10 (Top 10 Leaderboard)</h3>
                <div id="leaderboard" class="space-y-3">
                    <!-- ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
                </div>
            </div>

            <div class="text-center mt-8">
                <button onclick="restartGame()" class="bg-gradient-to-r from-pink-500 to-purple-500 text-white px-8 py-4 rounded-full text-xl font-semibold hover:from-pink-600 hover:to-purple-600 transform hover:scale-105 transition-all duration-300 shadow-lg">
                    ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà (Play Again) üîÑ
                </button>
            </div>
        </div>
    </div>

    <script>
        // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏ö‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏ß
        const questions = [
            {
                question: "‡πÄ‡∏à‡πâ‡∏≤‡∏ö‡πà‡∏≤‡∏ß‡πÄ‡∏à‡πâ‡∏≤‡∏™‡∏≤‡∏ß‡∏û‡∏ö‡∏Å‡∏±‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô? (Where did the bride and groom first meet?)",
                answers: ["‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢ (University)", "‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (At work)", "‡∏á‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô (Friend's party)", "‡πÅ‡∏≠‡∏õ‡∏´‡∏≤‡∏Ñ‡∏π‡πà (Dating app)"],
                correct: 1
            },
            {
                question: "‡πÄ‡∏à‡πâ‡∏≤‡∏™‡∏≤‡∏ß‡∏ä‡∏≠‡∏ö‡∏™‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î? (What is the bride's favorite color?)",
                answers: ["‡∏ä‡∏°‡∏û‡∏π (Pink)", "‡∏ü‡πâ‡∏≤ (Blue)", "‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß (Green)", "‡∏°‡πà‡∏ß‡∏á (Purple)"],
                correct: 0
            },
            {
                question: "‡πÄ‡∏à‡πâ‡∏≤‡∏ö‡πà‡∏≤‡∏ß‡∏Ç‡∏≠‡πÅ‡∏ï‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô? (Where did the groom propose?)",
                answers: ["‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (Restaurant)", "‡∏ä‡∏≤‡∏¢‡∏´‡∏≤‡∏î (Beach)", "‡∏ö‡πâ‡∏≤‡∏ô (Home)", "‡∏™‡∏ß‡∏ô‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏∞ (Park)"],
                correct: 1
            },
            {
                question: "‡∏Ñ‡∏π‡πà‡∏ö‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏ß‡∏ä‡∏≠‡∏ö‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î? (What do the couple enjoy doing together most?)",
                answers: ["‡∏î‡∏π‡∏´‡∏ô‡∏±‡∏á (Watching movies)", "‡∏ó‡∏≥‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (Cooking)", "‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß (Traveling)", "‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏° (Playing games)"],
                correct: 2
            },
            {
                question: "‡πÄ‡∏à‡πâ‡∏≤‡∏ö‡πà‡∏≤‡∏ß‡πÄ‡∏à‡πâ‡∏≤‡∏™‡∏≤‡∏ß‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ù‡∏±‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£? (What is the couple's shared dream?)",
                answers: ["‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (Open a restaurant)", "‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡∏£‡∏≠‡∏ö‡πÇ‡∏•‡∏Å (Travel around the world)", "‡∏°‡∏µ‡∏ö‡πâ‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÉ‡∏´‡∏ç‡πà (Have a big house)", "‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏™‡∏∏‡∏ô‡∏±‡∏Ç (Raise dogs)"],
                correct: 1
            }
        ];

        // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡∏°
        let players = [];
        let currentPlayer = null;
        let currentQuestion = 0;
        let score = 0;
        let timeLeft = 10;
        let timer;
        let gameActive = false;
        let gameStarted = false;
        let isHost = false;
        let gameState = 'waiting';
        let syncInterval;
        let roomId = null;
        let gameSession = null;
        let questionStartTime = null;
        let gameTimer = null;

        // Character ‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏Å‡∏≤‡∏£‡πå‡∏ï‡∏π‡∏ô 250 ‡πÅ‡∏ö‡∏ö
        const animalCharacters = [
            'üê∂', 'üê±', 'üê≠', 'üêπ', 'üê∞', 'ü¶ä', 'üêª', 'üêº', 'üê®', 'ü¶Å', 'üêØ', 'üê∏', 'üê∑', 'üêÆ', 'üêµ',
            'ü¶Ñ', 'üê¥', 'ü¶ì', 'ü¶å', 'üê∫', 'üêó', 'üêΩ', 'üêÑ', 'üêÇ', 'üêÉ', 'üê™', 'üê´', 'ü¶è', 'ü¶õ', 'üêò',
            'ü¶í', 'ü¶ò', 'üêøÔ∏è', 'ü¶î', 'ü¶á', 'üêæ', 'ü¶Æ', 'üêï‚Äçü¶∫', 'üê©', 'üêà', 'üêà‚Äç‚¨õ', 'ü¶ù', 'ü¶®', 'ü¶°', 'ü¶¶',
            'üêô', 'ü¶ë', 'üê†', 'üêü', 'üê°', 'ü¶à', 'üê≥', 'üêã', 'ü¶≠', 'üêß', 'ü¶û', 'ü¶Ä', 'üêö', 'ü™∏', 'üêå',
            'ü¶ê', 'ü¶™', 'üê¢', 'üêä', 'ü¶ï', 'ü¶ñ', 'üê≤', 'üêâ', 'ü¶é', 'üêç', 'üï∏Ô∏è', 'ü¶Ç', 'üï∑Ô∏è', 'ü¶ü', 'ü¶†',
            'üê¶', 'ü¶Ö', 'ü¶Ü', 'ü¶¢', 'ü¶â', 'üêì', 'ü¶É', 'ü¶ö', 'ü¶ú', 'üê•', 'üê§', 'üê£', 'ü¶©', 'üïäÔ∏è', 'ü¶§',
            'ü™∂', 'ü¶ã', 'üêõ', 'üêù', 'üêû', 'ü¶ó', 'üï∏Ô∏è', 'ü¶Ç', 'üï∑Ô∏è', 'ü¶ü', 'ü¶†', 'üêú', 'ü™≤', 'ü™≥', 'ü¶™',
            'ü¶Ñ', 'üê≤', 'üêâ', 'ü¶ï', 'ü¶ñ', 'ü¶£', 'ü¶è', 'ü¶õ', 'ü¶í', 'ü¶ò', 'ü¶®', 'ü¶°', 'ü¶¶', 'ü¶•', 'ü¶î',
            'üê∂', 'üê±', 'üê≠', 'üêπ', 'üê∞', 'ü¶ä', 'üêª', 'üêº', 'üê®', 'ü¶Å', 'üêØ', 'üê∏', 'üê∑', 'üêÆ', 'üêµ',
            'ü¶Ñ', 'üê¥', 'ü¶ì', 'ü¶å', 'üê∫', 'üêó', 'üêΩ', 'üêÑ', 'üêÇ', 'üêÉ', 'üê™', 'üê´', 'ü¶è', 'ü¶õ', 'üêò',
            'ü¶í', 'ü¶ò', 'üêøÔ∏è', 'ü¶î', 'ü¶á', 'üêæ', 'ü¶Æ', 'üêï‚Äçü¶∫', 'üê©', 'üêà', 'üêà‚Äç‚¨õ', 'ü¶ù', 'ü¶®', 'ü¶°', 'ü¶¶',
            'üêô', 'ü¶ë', 'üê†', 'üêü', 'üê°', 'ü¶à', 'üê≥', 'üêã', 'ü¶≠', 'üêß', 'ü¶û', 'ü¶Ä', 'üêö', 'ü™∏', 'üêå',
            'ü¶ê', 'ü¶™', 'üê¢', 'üêä', 'ü¶ï', 'ü¶ñ', 'üê≤', 'üêâ', 'ü¶é', 'üêç', 'üï∏Ô∏è', 'ü¶Ç', 'üï∑Ô∏è', 'ü¶ü', 'ü¶†',
            'üê¶', 'ü¶Ö', 'ü¶Ü', 'ü¶¢', 'ü¶â', 'üêì', 'ü¶É', 'ü¶ö', 'ü¶ú', 'üê•', 'üê§', 'üê£', 'ü¶©', 'üïäÔ∏è', 'ü¶§',
            'ü™∂', 'ü¶ã', 'üêõ', 'üêù', 'üêû', 'ü¶ó', 'üï∏Ô∏è', 'ü¶Ç', 'üï∑Ô∏è', 'ü¶ü', 'ü¶†', 'üêú', 'ü™≤', 'ü™≥', 'ü¶™',
            'ü¶Ñ', 'üê≤', 'üêâ', 'ü¶ï', 'ü¶ñ', 'ü¶£', 'ü¶è', 'ü¶õ', 'ü¶í', 'ü¶ò', 'ü¶®', 'ü¶°', 'ü¶¶', 'ü¶•', 'ü¶î',
            'üê∂', 'üê±', 'üê≠', 'üêπ', 'üê∞', 'ü¶ä', 'üêª', 'üêº', 'üê®', 'ü¶Å'
        ];

        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö 250 ‡∏ï‡∏±‡∏ß
        while (animalCharacters.length < 250) {
            const baseAnimals = ['üê∂', 'üê±', 'üê≠', 'üêπ', 'üê∞', 'ü¶ä', 'üêª', 'üêº', 'üê®', 'ü¶Å'];
            animalCharacters.push(...baseAnimals.slice(0, Math.min(baseAnimals.length, 250 - animalCharacters.length)));
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥
        function getUniqueAnimalCharacter() {
            const usedCharacters = players.map(player => player.character).filter(char => char);
            const availableCharacters = animalCharacters.filter(char => !usedCharacters.includes(char));
            
            if (availableCharacters.length === 0) {
                return animalCharacters[Math.floor(Math.random() * animalCharacters.length)];
            }
            
            return availableCharacters[Math.floor(Math.random() * availableCharacters.length)];
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏ó‡∏µ‡πà‡∏´‡∏≤‡∏¢‡πÑ‡∏õ
        function ensurePlayerCharacter(player) {
            if (!player.character || player.character === '' || player.character === null || player.character === undefined) {
                player.character = getUniqueAnimalCharacter();
            }
            return player.character;
        }

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà - ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÄ‡∏û‡∏µ‡∏¢‡∏á 1 ‡∏´‡πâ‡∏≠‡∏á
        function createNewGameRoom() {
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            const existingRoomId = localStorage.getItem('activeRoomId');
            if (existingRoomId) {
                const existingRoom = localStorage.getItem('room-' + existingRoomId);
                if (existingRoom) {
                    try {
                        const roomData = JSON.parse(existingRoom);
                        // ‡∏ñ‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á‡∏¢‡∏±‡∏á‡πÉ‡∏´‡∏°‡πà (‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 2 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á) ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°
                        if (Date.now() - roomData.timestamp < 7200000) {
                            roomId = existingRoomId;
                            console.log('Using existing room:', roomId);
                            return roomId;
                        }
                    } catch (e) {
                        console.log('Error parsing existing room data');
                    }
                }
            }
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡∏∞‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤
            clearOldRooms();
            
            roomId = 'WEDDING-GAME-' + Date.now().toString().slice(-8);
            gameSession = {
                roomId: roomId,
                createdAt: Date.now(),
                hostId: 'host-' + Date.now(),
                gameState: 'waiting',
                gameStarted: false,
                currentQuestion: 0,
                players: [],
                isActive: true
            };
            
            localStorage.setItem('currentGameSession', JSON.stringify(gameSession));
            localStorage.setItem('activeRoomId', roomId);
            localStorage.setItem('room-' + roomId, JSON.stringify({
                roomId: roomId,
                players: [],
                gameState: 'waiting',
                gameStarted: false,
                currentQuestion: 0,
                timestamp: Date.now(),
                isActive: true
            }));
            
            console.log('Created new game room:', roomId);
            return roomId;
        }

        // ‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß
        function clearOldRooms() {
            const keys = Object.keys(localStorage);
            keys.forEach(key => {
                if (key.startsWith('room-')) {
                    try {
                        const roomData = JSON.parse(localStorage.getItem(key));
                        // ‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πà‡∏≤‡∏Å‡∏ß‡πà‡∏≤ 2 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á
                        if (Date.now() - roomData.timestamp > 7200000) {
                            localStorage.removeItem(key);
                            console.log('Removed old room:', key);
                        }
                    } catch (e) {
                        localStorage.removeItem(key);
                    }
                }
            });
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡∏° - ‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£‡∏Ç‡∏∂‡πâ‡∏ô
        function syncGameData() {
            if (!roomId) {
                console.log('No room ID, creating new room');
                createNewGameRoom();
            }

            const gameData = {
                roomId: roomId,
                players: players,
                gameState: gameState,
                gameStarted: gameStarted,
                currentQuestion: currentQuestion,
                questionStartTime: questionStartTime,
                timeLeft: timeLeft,
                timestamp: Date.now()
            };
            
            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢
            try {
                localStorage.setItem('room-' + roomId, JSON.stringify(gameData));
                localStorage.setItem('activeRoomId', roomId);
            } catch (error) {
                console.error('Error saving game data:', error);
            }
            
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÄ‡∏ã‡∏™‡∏ä‡∏±‡∏ô‡πÄ‡∏Å‡∏°
            if (gameSession) {
                gameSession.players = players;
                gameSession.gameState = gameState;
                gameSession.gameStarted = gameStarted;
                gameSession.currentQuestion = currentQuestion;
                gameSession.questionStartTime = questionStartTime;
                gameSession.lastUpdate = Date.now();
                localStorage.setItem('currentGameSession', JSON.stringify(gameSession));
            }
        }

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡∏°‡∏à‡∏≤‡∏Å localStorage - ‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£‡∏Ç‡∏∂‡πâ‡∏ô
        function loadSharedGameData() {
            if (!roomId) return false;
            
            try {
                const data = localStorage.getItem('room-' + roomId);
                if (!data) return false;
                
                const gameData = JSON.parse(data);
                if (!gameData || !gameData.timestamp) return false;
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏≤‡∏¢‡∏∏‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 30 ‡∏ô‡∏≤‡∏ó‡∏µ)
                const dataAge = Date.now() - gameData.timestamp;
                if (dataAge > 1800000) return false;
                
                // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡∏°
                const existingPlayerIds = players.map(p => p.id);
                const newPlayers = gameData.players || [];
                
                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ
                newPlayers.forEach(newPlayer => {
                    const existingIndex = players.findIndex(p => p.id === newPlayer.id);
                    if (existingIndex >= 0) {
                        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà
                        players[existingIndex] = { ...players[existingIndex], ...newPlayer };
                    } else {
                        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà
                        players.push(newPlayer);
                    }
                });
                
                gameState = gameData.gameState || 'waiting';
                gameStarted = gameData.gameStarted || false;
                currentQuestion = gameData.currentQuestion || 0;
                questionStartTime = gameData.questionStartTime || null;
                timeLeft = gameData.timeLeft || 10;
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô
                players.forEach(player => {
                    ensurePlayerCharacter(player);
                });
                
                return true;
            } catch (error) {
                console.error('Error loading game data:', error);
                return false;
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏Å‡∏°‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ - Real-time ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Host
        function startGameSync() {
            console.log('Starting game sync...');
            
            loadSharedGameData();
            updateOnlineCount();
            updatePlayersList();
            
            // Storage events - ‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á
            window.addEventListener('storage', function(e) {
                if (e.key && e.key.startsWith('room-')) {
                    const oldGameStarted = gameStarted;
                    const oldPlayersCount = players.length;
                    
                    loadSharedGameData();
                    updateOnlineCount();
                    updatePlayersList();
                    
                    // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô Host ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà
                    if (isHost && players.length > oldPlayersCount) {
                        console.log('New player joined! Total players:', players.length);
                        showPlayerJoinedNotification();
                    }
                    
                    if (!oldGameStarted && gameStarted && !isHost) {
                        handleGameStart();
                    }
                }
            });
            
            // Polling ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Host ‡∏ó‡∏∏‡∏Å 1 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ, ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏∏‡∏Å 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
            const pollInterval = isHost ? 1000 : 2000;
            syncInterval = setInterval(() => {
                const oldGameStarted = gameStarted;
                const oldCurrentQuestion = currentQuestion;
                const oldPlayersCount = players.length;
                
                loadSharedGameData();
                updateOnlineCount();
                updatePlayersList();
                
                // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô Host ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà
                if (isHost && players.length > oldPlayersCount) {
                    console.log('New player detected via polling! Total players:', players.length);
                    showPlayerJoinedNotification();
                }
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°
                if (!oldGameStarted && gameStarted && !isHost) {
                    handleGameStart();
                }
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô)
                if (!isHost && gameStarted && oldCurrentQuestion !== currentQuestion) {
                    showQuestion();
                }
                
                // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó Host Dashboard ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà
                if (isHost && !document.getElementById('hostDashboard').classList.contains('hidden')) {
                    updateAnswerStats();
                    updateHostScoreboard();
                }
            }, pollInterval);
            
            // Visibility events
            document.addEventListener('visibilitychange', function() {
                if (!document.hidden) {
                    const oldGameStarted = gameStarted;
                    const oldGameState = gameState;
                    const oldPlayersCount = players.length;
                    
                    loadSharedGameData();
                    updateOnlineCount();
                    updatePlayersList();
                    
                    // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô Host ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà
                    if (isHost && players.length > oldPlayersCount) {
                        showPlayerJoinedNotification();
                    }
                    
                    if (!oldGameStarted && gameStarted && !isHost) {
                        handleGameStart();
                    }
                    
                    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏ö‡πÄ‡∏Å‡∏°
                    if (oldGameState !== 'finished' && gameState === 'finished' && !isHost) {
                        endGame();
                    }
                }
            });
            
            // ‡∏ü‡∏±‡∏á‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏à‡∏ö‡πÄ‡∏Å‡∏°‡∏à‡∏≤‡∏Å Host
            window.addEventListener('gameEnded', function(e) {
                if (e.detail.roomId === roomId && !isHost) {
                    endGame();
                }
            });
            
            // BroadcastChannel ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡πÅ‡∏ö‡∏ö Real-time
            if (typeof BroadcastChannel !== 'undefined') {
                const channel = new BroadcastChannel('wedding-game-sync');
                channel.onmessage = function(event) {
                    const data = event.data;
                    if (data.roomId === roomId) {
                        if (data.type === 'playerJoined' && isHost) {
                            loadSharedGameData();
                            updateOnlineCount();
                            updatePlayersList();
                            showPlayerJoinedNotification(data.player);
                        } else if (data.type === 'gameStarted' && !isHost) {
                            handleGameStart();
                        } else if (data.type === 'gameEnded' && !isHost) {
                            endGame();
                        }
                    }
                };
            }
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°
        function showPlayerJoinedNotification(player = null) {
            if (!isHost) return;
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏ö‡∏ö Toast
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 transform translate-x-full transition-transform duration-300';
            notification.innerHTML = `
                <div class="flex items-center">
                    <span class="text-2xl mr-2">üéâ</span>
                    <div>
                        <p class="font-semibold">‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°!</p>
                        <p class="text-sm">${player ? player.name : '‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà'} | ‡∏£‡∏ß‡∏° ${players.length} ‡∏Ñ‡∏ô</p>
                    </div>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            // ‡∏ã‡πà‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°
        function handleGameStart() {
            if (!isHost && currentPlayer && document.getElementById('gameScreen').classList.contains('hidden')) {
                console.log('Starting game for player:', currentPlayer.name);
                startGameForPlayer();
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏ã‡∏¥‡∏á‡∏Ñ‡πå
        function stopGameSync() {
            if (syncInterval) {
                clearInterval(syncInterval);
                syncInterval = null;
            }
        }

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á floating hearts
        function createFloatingHearts() {
            const container = document.getElementById('heartsContainer');
            setInterval(() => {
                const heart = document.createElement('div');
                heart.className = 'heart';
                heart.innerHTML = 'üíï';
                heart.style.left = Math.random() * 100 + '%';
                heart.style.animationDuration = (Math.random() * 3 + 3) + 's';
                container.appendChild(heart);
                
                setTimeout(() => {
                    heart.remove();
                }, 6000);
            }, 800);
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏´‡∏•‡∏±‡∏Å
        function showHomeScreen() {
            hideAllScreens();
            document.getElementById('homeScreen').classList.remove('hidden');
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
        function showHostScreen() {
            hideAllScreens();
            document.getElementById('passwordScreen').classList.remove('hidden');
            document.getElementById('adminPassword').value = '';
            setTimeout(() => {
                document.getElementById('adminPassword').focus();
            }, 100);
        }

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
        function verifyPassword() {
            const password = document.getElementById('adminPassword').value;
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            if (isMobileDevice()) {
                alert('‚ö†Ô∏è ‡πÇ‡∏´‡∏°‡∏î Host ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô!\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÄ‡∏Å‡∏°\n\n(Host mode is for computers only!\nPlease use a computer to control the game)');
                return;
            }
            
            if (password === '689') {
                hideAllScreens();
                document.getElementById('hostScreen').classList.remove('hidden');
                isHost = true;
                generateQRCode();
            } else {
                alert('‚ùå ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
                document.getElementById('adminPassword').value = '';
                document.getElementById('adminPassword').focus();
            }
        }

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        function isMobileDevice() {
            const userAgent = navigator.userAgent || navigator.vendor || window.opera;
            const mobileRegex = /android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i;
            const screenWidth = window.screen.width;
            const screenHeight = window.screen.height;
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö User Agent ‡πÅ‡∏•‡∏∞‡∏Ç‡∏ô‡∏≤‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
            return mobileRegex.test(userAgent) || 
                   (screenWidth <= 768 && screenHeight <= 1024) ||
                   ('ontouchstart' in window) ||
                   (navigator.maxTouchPoints > 0);
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô
        function showRegisterScreen() {
            // ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô
            if (!isMobileDevice()) {
                const usePhone = confirm('üì± ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°!\n‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î\n\n‡∏Ñ‡∏•‡∏¥‡∏Å OK ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠‡∏ö‡∏ô‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå\n‡∏´‡∏£‡∏∑‡∏≠ Cancel ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÅ‡∏ó‡∏ô\n\n(Recommended to use mobile phone for playing!\nFor the best experience\n\nClick OK to continue on computer\nor Cancel to use mobile instead)');
                
                if (!usePhone) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡∏à‡∏≤‡∏Å‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå Host\n\n(Please open this website on mobile phone or scan QR Code from Host computer)');
                    return;
                }
            }
            
            hideAllScreens();
            document.getElementById('registerScreen').classList.remove('hidden');
            isHost = false;
            document.querySelector('#registerScreen button[onclick="showHomeScreen()"]').style.display = 'block';
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏à‡∏≤‡∏Å QR Code
        function showRegisterScreenFromQR() {
            hideAllScreens();
            document.getElementById('registerScreen').classList.remove('hidden');
            isHost = false;
            document.querySelector('#registerScreen button[onclick="showHomeScreen()"]').style.display = 'none';
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏£‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏à‡πâ‡∏≤‡∏†‡∏≤‡∏û
        function showWaitingScreenAsHost() {
            hideAllScreens();
            document.getElementById('waitingScreen').classList.remove('hidden');
            
            document.getElementById('startGameBtn').style.display = 'block';
            document.getElementById('waitingMessage').style.display = 'none';
            
            if (roomId) {
                document.getElementById('waitingRoomId').textContent = roomId.slice(-8);
            }
            
            console.log('Host viewing waiting screen for room:', roomId);
            
            loadSharedGameData();
            updatePlayersList();
            updateOnlineCount();
            
            startGameSync();
        }

        // ‡∏ã‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        function hideAllScreens() {
            const screens = ['homeScreen', 'passwordScreen', 'hostScreen', 'registerScreen', 'waitingScreen', 'gameScreen', 'resultScreen', 'hostDashboard'];
            screens.forEach(screen => {
                document.getElementById(screen).classList.add('hidden');
            });
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤ Host Dashboard
        function showHostDashboard() {
            hideAllScreens();
            document.getElementById('hostDashboard').classList.remove('hidden');
            
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡πâ‡∏≠‡∏á
            document.getElementById('hostRoomId').textContent = roomId ? roomId.slice(-8) : '-';
            document.getElementById('hostPlayerCount').textContent = players.length;
            
            // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÅ‡∏£‡∏Å
            showHostQuestion();
            
            // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó Host Dashboard
            startHostDashboardUpdates();
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÉ‡∏ô Host Dashboard
        function showHostQuestion() {
            if (currentQuestion >= questions.length) {
                hostEndGame();
                return;
            }

            const question = questions[currentQuestion];
            
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°
            document.getElementById('hostQuestionNumber').textContent = currentQuestion + 1;
            document.getElementById('hostQuestionText').textContent = question.question;
            
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            for (let i = 0; i < 4; i++) {
                document.getElementById(`hostAnswer${i}`).textContent = question.answers[i];
            }
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
            document.getElementById('hostCorrectText').textContent = question.answers[question.correct];
            
            // ‡πÑ‡∏Æ‡πÑ‡∏•‡∏ó‡πå‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å
            const answerDivs = document.querySelectorAll('#hostDashboard .grid > div');
            answerDivs.forEach((div, index) => {
                if (index === question.correct) {
                    div.classList.add('ring-4', 'ring-green-500');
                } else {
                    div.classList.remove('ring-4', 'ring-green-500');
                }
            });
            
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö
            resetAnswerStats();
            
            // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤ Host
            startHostTimer();
        }

        // ‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Host
        function startHostTimer() {
            let hostTimeLeft = 10;
            document.getElementById('hostTimer').textContent = hostTimeLeft;
            
            const hostTimerInterval = setInterval(() => {
                hostTimeLeft--;
                document.getElementById('hostTimer').textContent = hostTimeLeft;
                
                if (hostTimeLeft <= 0) {
                    clearInterval(hostTimerInterval);
                    // ‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏≠ 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏õ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
                    setTimeout(() => {
                        currentQuestion++;
                        questionStartTime = Date.now();
                        syncGameData(); // ‡∏™‡πà‡∏á‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏õ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
                        showHostQuestion();
                    }, 3000);
                }
            }, 1000);
        }

        // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö
        function resetAnswerStats() {
            document.getElementById('answerStatsA').textContent = '0';
            document.getElementById('answerStatsB').textContent = '0';
            document.getElementById('answerStatsC').textContent = '0';
            document.getElementById('answerStatsD').textContent = '0';
            document.getElementById('answeredCount').textContent = '0';
            document.getElementById('totalPlayersCount').textContent = players.length;
        }

        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö
        function updateAnswerStats() {
            const currentQuestionIndex = currentQuestion;
            const stats = [0, 0, 0, 0]; // A, B, C, D
            let answeredCount = 0;
            
            players.forEach(player => {
                if (player.answers && player.answers.length > currentQuestionIndex) {
                    const answer = player.answers[currentQuestionIndex];
                    if (answer.selected >= 0 && answer.selected <= 3) {
                        stats[answer.selected]++;
                    }
                    answeredCount++;
                }
            });
            
            document.getElementById('answerStatsA').textContent = stats[0];
            document.getElementById('answerStatsB').textContent = stats[1];
            document.getElementById('answerStatsC').textContent = stats[2];
            document.getElementById('answerStatsD').textContent = stats[3];
            document.getElementById('answeredCount').textContent = answeredCount;
        }

        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó Scoreboard ‡πÉ‡∏ô Host Dashboard
        function updateHostScoreboard() {
            const hostLeaderboard = document.getElementById('hostLeaderboard');
            hostLeaderboard.innerHTML = '';
            
            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ï‡∏≤‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
            const sortedPlayers = [...players].sort((a, b) => {
                if (b.score !== a.score) {
                    return b.score - a.score;
                }
                // ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢
                const aAvgTime = a.answers && a.answers.length > 0 ? 
                    a.answers.reduce((sum, ans) => sum + (ans.timeLeft || 0), 0) / a.answers.length : 0;
                const bAvgTime = b.answers && b.answers.length > 0 ? 
                    b.answers.reduce((sum, ans) => sum + (ans.timeLeft || 0), 0) / b.answers.length : 0;
                return bAvgTime - aAvgTime;
            });
            
            if (sortedPlayers.length === 0) {
                hostLeaderboard.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <div class="text-4xl mb-2">üë•</div>
                        <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏ô‡πÄ‡∏Å‡∏°</p>
                    </div>
                `;
                return;
            }
            
            sortedPlayers.forEach((player, index) => {
                const character = ensurePlayerCharacter(player);
                const rank = index + 1;
                let rankEmoji = '';
                let bgColor = '';
                
                if (rank === 1) {
                    rankEmoji = 'ü•á';
                    bgColor = 'bg-gradient-to-r from-yellow-100 to-yellow-200';
                } else if (rank === 2) {
                    rankEmoji = 'ü•à';
                    bgColor = 'bg-gradient-to-r from-gray-100 to-gray-200';
                } else if (rank === 3) {
                    rankEmoji = 'ü•â';
                    bgColor = 'bg-gradient-to-r from-orange-100 to-orange-200';
                } else {
                    rankEmoji = `${rank}`;
                    bgColor = 'bg-gradient-to-r from-blue-50 to-purple-50';
                }
                
                const answeredQuestions = player.answers ? player.answers.length : 0;
                const progress = Math.round((answeredQuestions / 5) * 100);
                
                const playerRow = document.createElement('div');
                playerRow.className = `${bgColor} p-4 rounded-xl shadow-md flex justify-between items-center mb-2`;
                playerRow.innerHTML = `
                    <div class="flex items-center">
                        <span class="text-xl mr-3 font-bold">${rankEmoji}</span>
                        <div class="text-2xl mr-3">${character}</div>
                        <div>
                            <p class="font-bold text-gray-800">${player.name}</p>
                            ${player.table ? `<p class="text-sm text-gray-600">‡πÇ‡∏ï‡πä‡∏∞ ${player.table}</p>` : ''}
                            <p class="text-xs text-gray-500">‡∏ï‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß: ${answeredQuestions}/5 (${progress}%)</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-2xl font-bold text-purple-600">${player.score}/5</p>
                        <p class="text-sm text-gray-600">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</p>
                    </div>
                `;
                hostLeaderboard.appendChild(playerRow);
            });
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó Host Dashboard
        function startHostDashboardUpdates() {
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏ó‡∏∏‡∏Å 1 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
            const hostUpdateInterval = setInterval(() => {
                if (!document.getElementById('hostDashboard').classList.contains('hidden')) {
                    loadSharedGameData();
                    updateAnswerStats();
                    updateHostScoreboard();
                    document.getElementById('hostPlayerCount').textContent = players.length;
                } else {
                    clearInterval(hostUpdateInterval);
                }
            }, 1000);
        }

        // Host ‡∏à‡∏ö‡πÄ‡∏Å‡∏°
        function hostEndGame() {
            gameState = 'finished';
            syncGameData();
            
            // ‡∏™‡πà‡∏á‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏à‡∏ö‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô
            window.dispatchEvent(new CustomEvent('gameEnded', {
                detail: { roomId: roomId, timestamp: Date.now() }
            }));
            
            if (typeof BroadcastChannel !== 'undefined') {
                const channel = new BroadcastChannel('wedding-game-sync');
                channel.postMessage({
                    type: 'gameEnded',
                    roomId: roomId,
                    timestamp: Date.now()
                });
                channel.close();
            }
            
            // Host ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
            showHostResults();
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Host
        function showHostResults() {
            hideAllScreens();
            document.getElementById('resultScreen').classList.remove('hidden');
            
            // ‡∏ã‡πà‡∏≠‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß (‡πÄ‡∏û‡∏£‡∏≤‡∏∞ Host ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡πà‡∏ô)
            document.getElementById('playerScoreSection').style.display = 'none';
            
            // ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Leaderboard
            setTimeout(() => {
                loadSharedGameData();
                const activePlayers = players.filter(p => p.answers && p.answers.length > 0);
                activePlayers.sort((a, b) => {
                    if (b.score !== a.score) {
                        return b.score - a.score;
                    }
                    const aAvgTime = a.answers.reduce((sum, ans) => sum + (ans.timeLeft || 0), 0) / a.answers.length;
                    const bAvgTime = b.answers.reduce((sum, ans) => sum + (ans.timeLeft || 0), 0) / b.answers.length;
                    return bAvgTime - aAvgTime;
                });
                
                showLeaderboard(activePlayers);
            }, 1000);
        }

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code
        function generateQRCode() {
            if (!roomId) {
                createNewGameRoom();
            }
            
            const currentURL = window.location.href.split('?')[0];
            const gameURL = currentURL + '?join=true&room=' + roomId;
            
            document.getElementById('shareLink').value = gameURL;
            
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏ô Host Screen
            document.getElementById('hostRoomDisplay').textContent = roomId.slice(-8);
            
            const qrContainer = document.getElementById('qrcode');
            qrContainer.innerHTML = '';
            
            console.log('Generating QR Code for room:', roomId, 'URL:', gameURL);
            
            generateQRCodeWithGoogleCharts(gameURL);
            
            // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏ô Host Screen
            updateHostOnlineCount();
            
            // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Host
            startGameSync();
        }

        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏ô Host Screen
        function updateHostOnlineCount() {
            const hostOnlineElement = document.getElementById('hostOnlineCount');
            if (hostOnlineElement) {
                hostOnlineElement.textContent = players.length;
            }
        }

        // ‡πÉ‡∏ä‡πâ Google Charts API ‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code
        function generateQRCodeWithGoogleCharts(url) {
            const qrContainer = document.getElementById('qrcode');
            
            const qrSize = 200;
            const qrURL = `https://chart.googleapis.com/chart?chs=${qrSize}x${qrSize}&cht=qr&chl=${encodeURIComponent(url)}&choe=UTF-8`;
            
            console.log('Creating QR Code with Google Charts API:', qrURL);
            
            const img = document.createElement('img');
            img.src = qrURL;
            img.alt = 'QR Code ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏Å‡∏°';
            img.className = 'mx-auto border-2 border-purple-300 rounded-lg shadow-lg';
            img.style.width = qrSize + 'px';
            img.style.height = qrSize + 'px';
            
            img.onload = function() {
                console.log('QR Code loaded successfully');
            };
            
            img.onerror = function() {
                console.error('Google Charts QR Code failed, using fallback');
                generateQRCodeFallback(url);
            };
            
            qrContainer.appendChild(img);
        }

        // Fallback method ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code
        function generateQRCodeFallback(url) {
            const qrContainer = document.getElementById('qrcode');
            qrContainer.innerHTML = '';
            
            const qrSize = 200;
            const alternativeQRURL = `https://api.qrserver.com/v1/create-qr-code/?size=${qrSize}x${qrSize}&data=${encodeURIComponent(url)}`;
            
            console.log('Trying alternative QR API:', alternativeQRURL);
            
            const img = document.createElement('img');
            img.src = alternativeQRURL;
            img.alt = 'QR Code ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏Å‡∏°';
            img.className = 'mx-auto border-2 border-purple-300 rounded-lg shadow-lg';
            img.style.width = qrSize + 'px';
            img.style.height = qrSize + 'px';
            
            img.onload = function() {
                console.log('Alternative QR Code loaded successfully');
            };
            
            img.onerror = function() {
                console.error('All QR Code methods failed, showing manual option');
                qrContainer.innerHTML = `
                    <div class="bg-purple-100 border-2 border-purple-300 rounded-lg p-6 text-center shadow-lg" style="width: 200px; height: 200px; margin: 0 auto; display: flex; flex-direction: column; justify-content: center;">
                        <div class="text-4xl mb-3">üì±</div>
                        <p class="text-sm text-purple-700 font-semibold mb-2">QR Code ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏î‡πâ</p>
                        <p class="text-xs text-purple-600">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÅ‡∏ó‡∏ô</p>
                    </div>
                `;
            };
            
            qrContainer.appendChild(img);
        }

        // ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå
        function copyLink() {
            const linkInput = document.getElementById('shareLink');
            linkInput.select();
            linkInput.setSelectionRange(0, 99999);
            
            navigator.clipboard.writeText(linkInput.value).then(() => {
                const button = event.target;
                const originalText = button.innerHTML;
                button.innerHTML = '‚úÖ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß!';
                button.classList.add('bg-green-500');
                button.classList.remove('bg-blue-500');
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.classList.remove('bg-green-500');
                    button.classList.add('bg-blue-500');
                }, 2000);
            }).catch(() => {
                try {
                    document.execCommand('copy');
                    alert('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏•‡πâ‡∏ß!');
                } catch (err) {
                    alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á');
                }
            });
        }

        // ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô - ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÉ‡∏´‡πâ‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏Å‡∏£‡πà‡∏á‡∏Ç‡∏∂‡πâ‡∏ô
        function registerPlayer() {
            const name = document.getElementById('playerName').value.trim();
            const table = document.getElementById('playerTable').value.trim();
            
            if (!name) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (Please enter your name)');
                return;
            }
            
            if (!roomId) {
                alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á (Room not found, please scan QR Code again)');
                return;
            }
            
            console.log('Registering player:', name, 'to room:', roomId);
            
            // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô
            for (let i = 0; i < 3; i++) {
                loadSharedGameData();
            }
            console.log('Current players in room before registration:', players.length);
            
            if (players.length >= 250) {
                alert('‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢ ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏ï‡πá‡∏°‡πÅ‡∏•‡πâ‡∏ß (250 ‡∏Ñ‡∏ô) (Sorry, game is full - 250 players)');
                return;
            }
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏ã‡πâ‡∏≥‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            const existingPlayer = players.find(p => p.name.toLowerCase() === name.toLowerCase());
            if (existingPlayer) {
                alert('‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∑‡πà‡∏ô (This name is already taken in this room, please use another name)');
                return;
            }
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà
            currentPlayer = {
                id: 'player-' + Date.now() + '-' + Math.floor(Math.random() * 10000),
                name: name,
                table: table || '',
                character: getUniqueAnimalCharacter(),
                score: 0,
                answers: [],
                joinedAt: Date.now(),
                roomId: roomId,
                registrationTimestamp: Date.now()
            };
            
            console.log('Created new player:', currentPlayer);
            
            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
            players.push(currentPlayer);
            
            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô localStorage
            localStorage.setItem('currentPlayer', JSON.stringify(currentPlayer));
            localStorage.setItem('playerRoomId', roomId);
            
            // ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡∏°‡∏£‡∏ß‡∏°‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    syncGameData();
                    console.log('Sync attempt', i + 1, 'for player registration');
                }, i * 200);
            }
            
            // ‡∏™‡πà‡∏á‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏´‡∏•‡∏≤‡∏¢‡πÅ‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô
            setTimeout(() => {
                window.dispatchEvent(new CustomEvent('playerJoined', {
                    detail: { player: currentPlayer, roomId: roomId, timestamp: Date.now() }
                }));
                
                window.dispatchEvent(new StorageEvent('storage', {
                    key: 'room-' + roomId,
                    newValue: JSON.stringify({
                        roomId: roomId,
                        players: players,
                        timestamp: Date.now()
                    })
                }));
                
                if (typeof BroadcastChannel !== 'undefined') {
                    const channel = new BroadcastChannel('wedding-game-sync');
                    channel.postMessage({
                        type: 'playerJoined',
                        roomId: roomId,
                        player: currentPlayer,
                        totalPlayers: players.length,
                        timestamp: Date.now()
                    });
                    channel.close();
                }
                
                console.log('All sync signals sent for player registration');
            }, 100);
            
            console.log('Player registered successfully to room:', roomId, 'Total players:', players.length);
            
            showWaitingScreen();
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏£‡∏≠
        function showWaitingScreen() {
            document.getElementById('registerScreen').classList.add('hidden');
            document.getElementById('waitingScreen').classList.remove('hidden');
            
            document.getElementById('startGameBtn').style.display = 'none';
            document.getElementById('waitingMessage').style.display = 'block';
            
            if (roomId) {
                document.getElementById('waitingRoomId').textContent = roomId.slice(-8);
            }
            
            if (currentPlayer) {
                ensurePlayerCharacter(currentPlayer);
                document.getElementById('welcomeName').textContent = currentPlayer.name;
                document.getElementById('welcomeTable').textContent = currentPlayer.table ? `‡πÇ‡∏ï‡πä‡∏∞ ${currentPlayer.table}` : '';
                document.getElementById('playerCharacter').textContent = currentPlayer.character;
                
                localStorage.setItem('currentPlayer', JSON.stringify(currentPlayer));
            }
            
            updatePlayersList();
            updateOnlineCount();
            
            startGameSync();
        }

        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô
        function updatePlayersList() {
            const playersList = document.getElementById('playersList');
            
            if (!playersList) {
                console.log('Players list element not found');
                return;
            }
            
            console.log('Updating players list with', players.length, 'players');
            playersList.innerHTML = '';
            
            if (players.length === 0) {
                playersList.innerHTML = `
                    <div class="col-span-full text-center text-gray-500 py-8">
                        <div class="text-4xl mb-2">üë•</div>
                        <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</p>
                        <p class="text-sm">(No players joined yet)</p>
                    </div>
                `;
                return;
            }
            
            players.forEach((player, index) => {
                const character = ensurePlayerCharacter(player);
                
                const playerCard = document.createElement('div');
                playerCard.className = 'player-card bg-gradient-to-r from-pink-100 to-purple-100 p-4 rounded-xl shadow-md';
                playerCard.innerHTML = `
                    <div class="text-center">
                        <div class="text-4xl mb-2">${character}</div>
                        <p class="font-semibold text-gray-800">${player.name}</p>
                        ${player.table ? `<p class="text-sm text-gray-600">‡πÇ‡∏ï‡πä‡∏∞ ${player.table}</p>` : ''}
                        <p class="text-xs text-gray-400 mt-1">ID: ${player.id.toString().slice(-6)}</p>
                    </div>
                `;
                playersList.appendChild(playerCard);
            });
            
            console.log('Players list updated successfully');
        }

        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô
        function updateOnlineCount() {
            const count = players.length;
            const onlineCountElements = ['onlineCount', 'onlineCountRegister', 'totalPlayers', 'gamePlayerCount', 'hostOnlineCount'];
            
            onlineCountElements.forEach(elementId => {
                const element = document.getElementById(elementId);
                if (element) {
                    element.textContent = count;
                }
            });
            
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÉ‡∏ô Host Screen ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
            updateHostOnlineCount();
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏° (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Admin ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô) - Host ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô
        function startGame() {
            if (!isHost) {
                alert('‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Admin ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÑ‡∏î‡πâ (Only Admin can start the game)');
                return;
            }
            
            if (players.length === 0) {
                alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏° (No players joined yet)');
                return;
            }
            
            console.log('Admin starting game with', players.length, 'players');
            
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏Å‡∏°
            gameStarted = true;
            gameState = 'playing';
            currentQuestion = 0;
            questionStartTime = Date.now();
            timeLeft = 10;
            
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô
            players.forEach(player => {
                player.score = 0;
                player.answers = [];
                player.currentQuestion = 0;
            });
            
            // ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô
            syncGameData();
            
            // ‡∏™‡πà‡∏á‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°
            window.dispatchEvent(new CustomEvent('gameStarted', {
                detail: { 
                    roomId: roomId, 
                    players: players.length,
                    currentQuestion: currentQuestion,
                    questionStartTime: questionStartTime,
                    timestamp: Date.now()
                }
            }));
            
            if (typeof BroadcastChannel !== 'undefined') {
                const channel = new BroadcastChannel('wedding-game-sync');
                channel.postMessage({
                    type: 'gameStarted',
                    roomId: roomId,
                    players: players,
                    currentQuestion: currentQuestion,
                    questionStartTime: questionStartTime,
                    gameStarted: true,
                    timestamp: Date.now()
                });
                channel.close();
            }
            
            console.log('Game start signals sent to all players');
            
            // Host ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Host Dashboard ‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°
            showHostDashboard();
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô
        function startGameForPlayer() {
            document.getElementById('waitingScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');
            
            if (currentPlayer) {
                ensurePlayerCharacter(currentPlayer);
                document.getElementById('gamePlayerCharacter').textContent = currentPlayer.character;
                localStorage.setItem('currentPlayer', JSON.stringify(currentPlayer));
            }
            
            score = 0;
            showQuestion();
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° - ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤ 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
        function showQuestion() {
            if (currentQuestion >= questions.length) {
                endGame();
                return;
            }

            gameActive = true;
            timeLeft = 10; // ‡∏Ñ‡∏á‡∏ó‡∏µ‡πà 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
            questionStartTime = Date.now();
            
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó UI
            document.getElementById('questionNumber').textContent = currentQuestion + 1;
            document.getElementById('score').textContent = score;
            document.getElementById('questionText').textContent = questions[currentQuestion].question;
            
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            for (let i = 0; i < 4; i++) {
                document.getElementById(`answerText${i}`).textContent = questions[currentQuestion].answers[i];
                document.getElementById(`answer${i}`).disabled = false;
                document.getElementById(`answer${i}`).classList.remove('correct-answer', 'wrong-answer');
            }

            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó Progress Bar
            const progress = ((currentQuestion + 1) / questions.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';

            // ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Host)
            if (isHost) {
                syncGameData();
            }

            // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤
            startTimer();
        }

        // ‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤ - ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡∏£‡∏á‡πÄ‡∏ß‡∏•‡∏≤ 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
        function startTimer() {
            // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà Host ‡πÉ‡∏´‡πâ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÅ‡∏ä‡∏£‡πå
            if (!isHost && questionStartTime) {
                const elapsed = Math.floor((Date.now() - questionStartTime) / 1000);
                timeLeft = Math.max(0, 10 - elapsed);
            }
            
            document.getElementById('timer').textContent = timeLeft;
            
            timer = setInterval(() => {
                timeLeft--;
                document.getElementById('timer').textContent = timeLeft;
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    if (gameActive) {
                        selectAnswer(-1); // ‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤ - ‡πÑ‡∏î‡πâ 0 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
                    }
                }
            }, 1000);
        }

        // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö - ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î
        function selectAnswer(selectedIndex) {
            if (!gameActive) return;
            
            gameActive = false;
            clearInterval(timer);
            
            const correctIndex = questions[currentQuestion].correct;
            let isCorrect = false;
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å
            document.getElementById(`answer${correctIndex}`).classList.add('correct-answer');
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö
            if (selectedIndex === correctIndex) {
                score++;
                currentPlayer.score++;
                isCorrect = true;
                document.getElementById('score').textContent = score;
            } else if (selectedIndex >= 0) {
                // ‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î
                document.getElementById(`answer${selectedIndex}`).classList.add('wrong-answer');
            }
            // ‡∏ñ‡πâ‡∏≤ selectedIndex === -1 ‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤ (‡πÑ‡∏î‡πâ 0 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)

            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö
            currentPlayer.answers.push({
                question: currentQuestion,
                selected: selectedIndex,
                correct: correctIndex,
                isCorrect: isCorrect,
                timeLeft: timeLeft,
                answeredAt: Date.now()
            });

            // ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            for (let i = 0; i < 4; i++) {
                document.getElementById(`answer${i}`).disabled = true;
            }

            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏ß‡∏°
            const playerIndex = players.findIndex(p => p.id === currentPlayer.id);
            if (playerIndex !== -1) {
                players[playerIndex] = { ...currentPlayer };
            }

            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô localStorage
            localStorage.setItem('currentPlayer', JSON.stringify(currentPlayer));
            
            // ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
            syncGameData();

            // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏≤‡∏°‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
            let resultMessage = '';
            if (selectedIndex === -1) {
                resultMessage = '‚è∞ ‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤! (Time\'s up!)';
            } else if (isCorrect) {
                resultMessage = 'üéâ ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! (Correct!)';
            } else {
                resultMessage = '‚ùå ‡∏ú‡∏¥‡∏î! (Wrong!)';
            }
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß
            const questionText = document.getElementById('questionText');
            const originalText = questionText.textContent;
            questionText.innerHTML = `<div class="text-2xl mb-2">${resultMessage}</div><div class="text-lg">${originalText}</div>`;

            // ‡πÑ‡∏õ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡∏´‡∏•‡∏±‡∏á 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
            setTimeout(() => {
                currentQuestion++;
                
                // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô Host ‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà
                if (isHost) {
                    questionStartTime = Date.now();
                    syncGameData();
                }
                
                showQuestion();
            }, 3000);
        }

        // ‡∏à‡∏ö‡πÄ‡∏Å‡∏° - ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö Top 10
        function endGame() {
            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('resultScreen').classList.remove('hidden');
            
            gameState = 'finished';
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô)
            document.getElementById('playerScoreSection').style.display = 'block';
            
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏ô array
            const playerIndex = players.findIndex(p => p.id === currentPlayer.id);
            if (playerIndex !== -1) {
                players[playerIndex] = { ...currentPlayer };
            }
            
            // ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡∏°‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢
            syncGameData();
            
            // ‡∏£‡∏≠‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
            setTimeout(() => {
                // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡πÑ‡∏î‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô
                loadSharedGameData();
                
                // ‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (‡πÄ‡∏•‡πà‡∏ô‡∏à‡∏£‡∏¥‡∏á)
                const activePlayers = players.filter(p => p.answers && p.answers.length > 0);
                
                // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ï‡∏≤‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô)
                activePlayers.sort((a, b) => {
                    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Å‡πà‡∏≠‡∏ô
                    if (b.score !== a.score) {
                        return b.score - a.score;
                    }
                    // ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏≠‡∏ö‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏ß‡πà‡∏≤
                    const aAvgTime = a.answers.reduce((sum, ans) => sum + (ans.timeLeft || 0), 0) / a.answers.length;
                    const bAvgTime = b.answers.reduce((sum, ans) => sum + (ans.timeLeft || 0), 0) / b.answers.length;
                    return bAvgTime - aAvgTime; // ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ = ‡∏ï‡∏≠‡∏ö‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏ß‡πà‡∏≤
                });
                
                // ‡∏´‡∏≤‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
                const playerRank = activePlayers.findIndex(p => p.id === currentPlayer.id) + 1;
                
                document.getElementById('finalScore').textContent = score;
                
                if (playerRank > 0) {
                    document.getElementById('playerRank').textContent = `üèÖ ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà ${playerRank} ‡∏à‡∏≤‡∏Å ${activePlayers.length} ‡∏Ñ‡∏ô (Rank ${playerRank} of ${activePlayers.length} players)`;
                } else {
                    document.getElementById('playerRank').textContent = `‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô (No competition data found)`;
                }
                
                // ‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö Top 10
                showLeaderboard(activePlayers);
                
                // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô emoji ‡∏ï‡∏≤‡∏°‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö
                let emoji = "üéâ";
                if (playerRank === 1) emoji = "üèÜ";
                else if (playerRank === 2) emoji = "ü•à";
                else if (playerRank === 3) emoji = "ü•â";
                else if (playerRank <= 10) emoji = "‚≠ê";
                
                document.getElementById('resultEmoji').textContent = emoji;
                
                console.log('Game ended. Final rankings:', activePlayers.map(p => ({ name: p.name, score: p.score })));
            }, 1000);
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô Top 10
        function showLeaderboard(activePlayers = null) {
            const leaderboard = document.getElementById('leaderboard');
            leaderboard.innerHTML = '';
            
            // ‡πÉ‡∏ä‡πâ activePlayers ‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏°‡∏≤ ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏£‡∏≠‡∏á‡∏à‡∏≤‡∏Å players ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            const playersToShow = activePlayers || players.filter(p => p.answers && p.answers.length > 0);
            
            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à
            playersToShow.sort((a, b) => {
                if (b.score !== a.score) {
                    return b.score - a.score;
                }
                // ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (‡∏ï‡∏≠‡∏ö‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏ß‡πà‡∏≤)
                const aAvgTime = a.answers.reduce((sum, ans) => sum + (ans.timeLeft || 0), 0) / a.answers.length;
                const bAvgTime = b.answers.reduce((sum, ans) => sum + (ans.timeLeft || 0), 0) / b.answers.length;
                return bAvgTime - aAvgTime;
            });
            
            const top10 = playersToShow.slice(0, 10);
            
            if (top10.length === 0) {
                leaderboard.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <div class="text-4xl mb-2">üèÜ</div>
                        <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</p>
                        <p class="text-sm">(No players have completed the game yet)</p>
                    </div>
                `;
                return;
            }
            
            top10.forEach((player, index) => {
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏ó‡∏µ‡πà‡∏´‡∏≤‡∏¢‡πÑ‡∏õ
                const character = ensurePlayerCharacter(player);
                
                const rank = index + 1;
                let rankEmoji = '';
                let bgColor = '';
                
                if (rank === 1) {
                    rankEmoji = 'ü•á';
                    bgColor = 'bg-gradient-to-r from-yellow-200 to-yellow-300 border-2 border-yellow-400';
                } else if (rank === 2) {
                    rankEmoji = 'ü•à';
                    bgColor = 'bg-gradient-to-r from-gray-200 to-gray-300 border-2 border-gray-400';
                } else if (rank === 3) {
                    rankEmoji = 'ü•â';
                    bgColor = 'bg-gradient-to-r from-orange-200 to-orange-300 border-2 border-orange-400';
                } else {
                    rankEmoji = `${rank}`;
                    bgColor = 'bg-gradient-to-r from-blue-100 to-purple-100';
                }
                
                const isCurrentPlayer = currentPlayer && player.id === currentPlayer.id;
                
                // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ï‡∏≠‡∏ö
                const avgTimeLeft = player.answers.reduce((sum, ans) => sum + (ans.timeLeft || 0), 0) / player.answers.length;
                const avgTimeUsed = 10 - avgTimeLeft;
                
                const playerRow = document.createElement('div');
                playerRow.className = `${bgColor} p-4 rounded-xl shadow-md flex justify-between items-center ${isCurrentPlayer ? 'ring-4 ring-pink-500 ring-opacity-50' : ''} mb-2`;
                playerRow.innerHTML = `
                    <div class="flex items-center">
                        <span class="text-2xl mr-4 font-bold">${rankEmoji}</span>
                        <div class="text-3xl mr-3">${character}</div>
                        <div>
                            <p class="font-bold text-gray-800">${player.name} ${isCurrentPlayer ? '(‡∏Ñ‡∏∏‡∏ì)' : ''}</p>
                            ${player.table ? `<p class="text-sm text-gray-600">‡πÇ‡∏ï‡πä‡∏∞ ${player.table}</p>` : ''}
                            <p class="text-xs text-gray-500">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢: ${avgTimeUsed.toFixed(1)}s</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-3xl font-bold text-purple-600">${player.score}/5</p>
                        <p class="text-sm text-gray-600">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</p>
                        <p class="text-xs text-gray-500">${Math.round((player.score/5)*100)}%</p>
                    </div>
                `;
                leaderboard.appendChild(playerRow);
            });
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            if (playersToShow.length > 10) {
                const morePlayersDiv = document.createElement('div');
                morePlayersDiv.className = 'text-center text-gray-500 mt-4 p-3 bg-gray-100 rounded-xl';
                morePlayersDiv.innerHTML = `
                    <p class="text-sm">‡πÅ‡∏•‡∏∞‡∏≠‡∏µ‡∏Å ${playersToShow.length - 10} ‡∏Ñ‡∏ô (And ${playersToShow.length - 10} more players)</p>
                `;
                leaderboard.appendChild(morePlayersDiv);
            }
            
            console.log('Leaderboard updated with', top10.length, 'players');
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà
        function restartGame() {
            stopGameSync();
            
            players = [];
            currentPlayer = null;
            score = 0;
            currentQuestion = 0;
            gameStarted = false;
            gameActive = false;
            isHost = false;
            gameState = 'waiting';
            
            localStorage.removeItem('currentPlayer');
            localStorage.removeItem('playerRoomId');
            
            if (timer) {
                clearInterval(timer);
            }
            
            document.getElementById('resultScreen').classList.add('hidden');
            showHomeScreen();
        }

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        function loadGameData() {
            loadSharedGameData();
            
            const savedCurrentPlayer = localStorage.getItem('currentPlayer');
            const savedPlayerRoomId = localStorage.getItem('playerRoomId');
            
            if (savedCurrentPlayer && savedPlayerRoomId) {
                currentPlayer = JSON.parse(savedCurrentPlayer);
                
                if (currentPlayer.roomId === savedPlayerRoomId) {
                    roomId = savedPlayerRoomId;
                    
                    loadSharedGameData();
                    
                    ensurePlayerCharacter(currentPlayer);
                    localStorage.setItem('currentPlayer', JSON.stringify(currentPlayer));
                    
                    const playerExists = players.find(p => p.id === currentPlayer.id);
                    if (!playerExists) {
                        players.push(currentPlayer);
                        syncGameData();
                    }
                    
                    console.log('Restored player session for room:', roomId);
                    showWaitingScreen();
                } else {
                    localStorage.removeItem('currentPlayer');
                    localStorage.removeItem('playerRoomId');
                    currentPlayer = null;
                }
            }
            
            updateOnlineCount();
        }

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL parameters
        function checkURLParameters() {
            const urlParams = new URLSearchParams(window.location.search);
            const joinParam = urlParams.get('join');
            const roomParam = urlParams.get('room');
            
            if (joinParam === 'true' && roomParam) {
                roomId = roomParam;
                console.log('Joining room from QR Code:', roomId);
                
                loadSharedGameData();
                
                showRegisterScreenFromQR();
                
                updateRoomInfo();
            } else if (joinParam === 'true') {
                alert('‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡πÉ‡∏´‡∏°‡πà (This link is invalid or expired, please scan a new QR Code)');
                showHomeScreen();
            } else {
                showHomeScreen();
            }
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô
        function updateRoomInfo() {
            const registerScreen = document.getElementById('registerScreen');
            if (registerScreen && roomId) {
                let roomInfoElement = document.getElementById('roomInfo');
                if (!roomInfoElement) {
                    roomInfoElement = document.createElement('div');
                    roomInfoElement.id = 'roomInfo';
                    roomInfoElement.className = 'mb-4 p-3 bg-purple-100 rounded-xl border border-purple-300';
                    
                    const inputContainer = registerScreen.querySelector('.mb-6');
                    inputContainer.parentNode.insertBefore(roomInfoElement, inputContainer);
                }
                
                roomInfoElement.innerHTML = `
                    <div class="text-center">
                        <p class="text-sm font-semibold text-purple-700">üè† ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô (Game Room)</p>
                        <p class="text-xs text-purple-600">ID: ${roomId.slice(-8)}</p>
                        <p class="text-xs text-purple-600">‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á: ${players.length} ‡∏Ñ‡∏ô</p>
                    </div>
                `;
            }
        }

        // ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á‡∏£‡∏≠
        function goBackFromWaiting() {
            if (isHost) {
                showHostScreen();
            } else {
                isHost = false;
                showRegisterScreen();
                if (currentPlayer) {
                    document.getElementById('playerName').value = currentPlayer.name;
                    document.getElementById('playerTable').value = currentPlayer.table;
                }
            }
        }

        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏µ‡∏ö‡∏±‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
        function debugGameState() {
            console.log('=== GAME DEBUG INFO ===');
            console.log('Room ID:', roomId);
            console.log('Is Host:', isHost);
            console.log('Players count:', players.length);
            console.log('Players:', players.map(p => ({ id: p.id, name: p.name, character: p.character })));
            console.log('Game State:', gameState);
            console.log('Game Started:', gameStarted);
            console.log('Current Player:', currentPlayer);
            
            const keys = ['room-' + roomId, 'currentGameData', 'globalGameData', 'allRoomsData', 'currentPlayer', 'activeRoomId'];
            keys.forEach(key => {
                const data = localStorage.getItem(key);
                if (data) {
                    try {
                        const parsed = JSON.parse(data);
                        console.log(key + ':', parsed);
                    } catch (e) {
                        console.log(key + ' (raw):', data);
                    }
                }
            });
            console.log('======================');
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏Å‡∏°
        window.onload = function() {
            console.log('Game initializing...');
            createFloatingHearts();
            loadGameData();
            checkURLParameters();
            
            loadSharedGameData();
            updateOnlineCount();
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏µ‡∏ö‡∏±‡∏Å‡∏ó‡∏∏‡∏Å 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
            setInterval(() => {
                if (isHost) {
                    console.log('Host sync check - Players:', players.length, 'Room:', roomId);
                }
            }, 10000);
        };

        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏∏‡∏Å 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
        setInterval(() => {
            if (roomId) {
                loadSharedGameData();
                updateOnlineCount();
            }
        }, 5000);
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'975a3f9bd361d335',t:'MTc1NjI4Mzg2Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
